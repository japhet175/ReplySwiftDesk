<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ReplySwiftDesk - Email Builder</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:40px;
}
.container {
  max-width:900px;
  margin:auto;
  background:white;
  padding:30px;
  border-radius:12px;
  box-shadow:0 4px 20px rgba(0,0,0,0.08);
}
h1 { text-align:center; margin-bottom:30px; }
input, textarea {
  width:100%; padding:12px; margin:10px 0;
  border:1px solid #ddd; border-radius:6px; font-size:15px;
}
textarea { min-height:150px; resize:vertical; }
.buttons { margin-top:10px; }
button {
  padding:12px 20px; border:none; border-radius:6px;
  font-size:14px; cursor:pointer; margin-right:10px;
}
#previewBtn { background:#6c757d; color:white; }
#sendBtn { background:#1a73e8; color:white; }
#sendBtn:hover { background:#1557b0; }
#status {
  margin-top:20px; padding:15px; border-radius:6px;
  background:#f1f3f5; min-height:50px;
}
iframe {
  width:100%; height:300px; border:1px solid #ddd;
  border-radius:6px; margin-top:20px; background:white;
}
</style>
</head>
<body>
<div class="container">
<h1>üìß ReplySwiftDesk Email Builder</h1>

<label>Recipient Email</label>
<input type="email" id="email" placeholder="client@email.com">

<label>Email HTML Content</label>
<textarea id="editor">
<h2>Hello,</h2>
<p>This is a test email from ReplySwiftDesk.</p>
</textarea>

<div class="buttons">
  <button id="previewBtn">üëÅ Preview</button>
  <button id="sendBtn">üì§ Send Email</button>
</div>

<div id="status">Ready.</div>

<h3>Live Preview</h3>
<iframe id="previewFrame"></iframe>
</div>

<script>
const baseUrl = "https://replyswiftdesk.site"; // ‚úÖ update to your backend domain
const statusBox = document.getElementById("status");
const sendBtn = document.getElementById("sendBtn");

function signature(){
  return `
  <div style="margin-top:25px; font-size:14px; border-top:1px solid #ddd; padding-top:10px;">
    <p>Best regards,<br>
    <strong>SwiftReply Team</strong><br>
    ReplySwiftDesk.site<br>
    +250 798 980 113</p>
  </div>`;
}

function unsubscribe(email){
  return `
  <div style="margin-top:15px; text-align:center;">
    <a href="${baseUrl}/unsubscribe?email=${encodeURIComponent(email)}"
       style="font-size:12px; color:#666; text-decoration:none;">
       Unsubscribe
    </a>
  </div>`;
}

function updatePreview(){
  const html = document.getElementById("editor").value;
  const email = document.getElementById("email").value || "test@email.com";
  document.getElementById("previewFrame").srcdoc =
    html + signature() + unsubscribe(email);
}

async function sendEmail(){
  const email = document.getElementById("email").value.trim();
  const html = document.getElementById("editor").value.trim();

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailRegex.test(email) || !html) {
    statusBox.innerHTML = "‚ùå Please enter a valid email and message.";
    return;
  }

  statusBox.innerHTML = "‚è≥ Sending...";
  sendBtn.disabled = true;

  try {
    const response = await fetch(`${baseUrl}/send-email`, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        email: email,
        message: html + signature() + unsubscribe(email)
      })
    });

    const data = await response.json();
    if (data.success) {
      statusBox.innerHTML = "‚úÖ Email sent successfully!";
    } else {
      statusBox.innerHTML = "‚ùå " + (data.error || "Unknown error");
    }
  } catch (err) {
    statusBox.innerHTML = "‚ùå Network error.";
  } finally {
    sendBtn.disabled = false;
  }
}

document.getElementById("previewBtn").addEventListener("click", updatePreview);
sendBtn.addEventListener("click", sendEmail);
</script>
</body>
</html>
